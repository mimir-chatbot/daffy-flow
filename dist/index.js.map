{"version":3,"file":"index.js","names":["nodes: Node[]","edges: Edge[]","daffyNodes: DaffyNode[]","daffyEdges: DaffyEdge[]","tools: Record<string, DaffyTool[]>","end_nodes: string[]","toolNode: DaffyToolNode","target: string | undefined"],"sources":["../src/constants.ts","../src/fromDaffyDuck.ts","../src/helpers.ts","../src/toDaffyDuck.ts"],"sourcesContent":["export const DAFFY_TO_FLOW_NODES = {\n  AgentNode: 'agent',\n  RagNode: 'rag',\n  ToolNode: 'tool',\n  ConditionalLLMNode: 'conditional_llm',\n  PostgressIntrospectionNode: 'postgres_introspection',\n  MSSQLIntrospectionNode: 'mssql_introspection',\n  MySQLIntrospectionNode: 'mysql_introspection',\n} as const\n\nexport const DAFFY_START = 'START'\nexport const DAFFY_END = 'END'\n\nexport const FLOW_TO_DAFFY_NODES = {\n  agent: 'AgentNode',\n  rag: 'RagNode',\n  tool: 'ToolNode',\n  conditional_llm: 'ConditionalLLMNode',\n  postgres_introspection: 'PostgressIntrospectionNode',\n  mssql_introspection: 'MSSQLIntrospectionNode',\n  mysql_introspection: 'MySQLIntrospectionNode',\n} as const\n\nexport const FLOW_TO_DAFFY_TOOLS = {\n  mcp: 'MCPTool',\n  excel: 'ExcelGeneratorTool',\n  postgres: 'PostgressTool',\n  metadata: 'SaveMetadataTool',\n  whatsapp_send_message: 'WhatsappSendMessageTool',\n  odbc: 'AIOOdbcTool',\n} as const\n\nexport const DAFFY_TO_FLOW_TOOLS = {\n  MCPTool: 'mcp',\n  ExcelGeneratorTool: 'excel',\n  PostgressTool: 'postgres',\n  SaveMetadataTool: 'metadata',\n  WhatsappSendMessageTool: 'whatsapp_send_message',\n  AIOOdbcTool: 'odbc',\n} as const\n\nexport type FlowNodeType = keyof typeof FLOW_TO_DAFFY_NODES\n\nexport type FlowToolType = keyof typeof FLOW_TO_DAFFY_TOOLS\n\nexport type DaffyNodeType = keyof typeof DAFFY_TO_FLOW_NODES\n\nexport type DaffyToolType = keyof typeof DAFFY_TO_FLOW_TOOLS\n","import type { Edge, Node } from '@vue-flow/core'\nimport type { DaffyGraph } from './models/graph'\nimport { DAFFY_TO_FLOW_NODES, DAFFY_TO_FLOW_TOOLS } from './constants'\n\nexport function fromDaffyDuck(graph: DaffyGraph): { nodes: Node[], edges: Edge[] } {\n  const nodes: Node[] = [\n    { id: 'START', type: 'start', position: { x: -500, y: 0 }, deletable: false },\n    { id: 'END', type: 'end', position: { x: 500, y: 0 }, deletable: false },\n  ]\n  const edges: Edge[] = []\n\n  for (const daffyNode of graph.nodes.filter(n => n.node !== 'ToolNode')) {\n    nodes.push({\n      id: daffyNode.id,\n      type: DAFFY_TO_FLOW_NODES[daffyNode.node],\n      position: daffyNode.position,\n      data: {\n        ...daffyNode.settings,\n        ...('parallel_tool_calling' in daffyNode ? { parallel_tool_calling: daffyNode.parallel_tool_calling } : {}),\n      },\n    })\n  }\n\n  graph.nodes.filter(n => n.node === 'AgentNode').forEach((node) => {\n    node.tools.forEach((tool) => {\n      const toolType = DAFFY_TO_FLOW_TOOLS[tool.name]\n      nodes.push({\n        id: tool.id || `tool_node_${toolType}_${node.id}`,\n        type: DAFFY_TO_FLOW_NODES.ToolNode,\n        position: tool.position || { x: 0, y: 0 },\n        data: {\n          value: toolType,\n          config: tool.settings,\n        },\n      })\n    })\n    edges.push(...node.tools.map((tool, index) => {\n      const toolType = DAFFY_TO_FLOW_TOOLS[tool.name]\n      return {\n        id: `tool_node_${toolType}_${index}`,\n        source: node.id,\n        target: tool.id || `tool_node_${toolType}_${node.id}`,\n        sourceHandle: 'source-agents-tools',\n      } satisfies Edge\n    }))\n  })\n\n  edges.push(...graph.edges.filter(e => !e.source.startsWith('tool_node') && !Object.keys(e.condition || {}).includes('tool_node')).map((e, index) => ({\n    id: e.id || `${e.source}_${e.target}_${index}`,\n    source: e.source,\n    target: e.target || Object.keys(e.condition || {})[0] || 'tool_node',\n    sourceHandle: e.source_handle,\n    targetHandle: e.target_handle,\n  } satisfies Edge)))\n\n  return {\n    nodes,\n    edges,\n  }\n}\n","import type { Edge } from '@vue-flow/core'\nimport type { DaffyEdge } from './models/graph'\nimport { DAFFY_END } from './constants'\n\nexport function findToolSource(source: string, edges: Edge[]): [index?: number, source?: string] {\n  for (const [index, edge] of edges.entries()) {\n    if (source === edge.target) return [index, edge.source]\n    if (source === edge.source) return [index, edge.target]\n  }\n  return []\n}\n\nexport function findConditionalEdgeTarget(source: string, edges: DaffyEdge[]): [index?: number, source?: string] {\n  for (const [index, edge] of edges.entries())\n    if (source === edge.source) return [index, edge.target]\n\n  return []\n}\n\nexport function endTargetExist(source: string, edges: DaffyEdge[]): boolean {\n  for (const edge of edges) {\n    if (edge.source === source && edge.target === DAFFY_END)\n      return true\n  }\n\n  return false\n}\n","import type { Edge, Node } from '@vue-flow/core'\nimport type { DaffyEdge, DaffyGraph, DaffyNode, DaffyTool, DaffyToolNode } from './models/graph'\nimport { DAFFY_END, FLOW_TO_DAFFY_NODES, FLOW_TO_DAFFY_TOOLS } from './constants'\nimport { endTargetExist, findConditionalEdgeTarget, findToolSource } from './helpers'\n\nexport function toDaffyDuck(nodes: Node[], edges: Edge[]): DaffyGraph {\n  const daffyNodes: DaffyNode[] = []\n  const daffyEdges: DaffyEdge[] = []\n  const tools: Record<string, DaffyTool[]> = {}\n\n  const end_nodes: string[] = []\n  for (const node of nodes) {\n    if (node.type === 'start' || node.type === 'end') {\n      end_nodes.push(node.id)\n      continue\n    }\n\n    const nodeType = FLOW_TO_DAFFY_NODES[node.type as keyof typeof FLOW_TO_DAFFY_NODES]\n\n    if (nodeType === 'ToolNode') {\n      const [index, toolSource] = findToolSource(node.id, edges)\n      const toolType = node.data.value as string\n      if (!toolSource || index === undefined || !(toolType in FLOW_TO_DAFFY_TOOLS)) continue\n\n      const daffyToolName = FLOW_TO_DAFFY_TOOLS[toolType as keyof typeof FLOW_TO_DAFFY_TOOLS]\n\n      if (!Object.keys(tools).includes(toolSource))\n        tools[toolSource] = []\n\n      tools[toolSource].push({\n        id: node.id,\n        position: node.position,\n        name: daffyToolName,\n        settings: node.data.config,\n      })\n\n      edges.splice(index, 1)\n      continue\n    }\n\n    if (nodeType === 'AgentNode') {\n      const { parallel_tool_calling = true, ...settings } = node.data ?? {}\n      daffyNodes.push({\n        id: node.id,\n        node: FLOW_TO_DAFFY_NODES.agent,\n        position: node.position,\n        settings,\n        parallel_tool_calling,\n        tools: [],\n      })\n      continue\n    }\n\n    daffyNodes.push({\n      id: node.id,\n      node: nodeType,\n      settings: node.data,\n      position: node.position,\n    })\n  }\n\n  for (const edge of edges) {\n    let target = edge.target\n    if (end_nodes.includes(target))\n      target = DAFFY_END\n\n    if (target === DAFFY_END && endTargetExist(edge.source, daffyEdges))\n      continue\n\n    daffyEdges.push({\n      id: edge.id,\n      source: edge.source,\n      target,\n      source_handle: edge.sourceHandle || undefined,\n      target_handle: edge.targetHandle || undefined,\n    } satisfies DaffyEdge)\n  }\n\n  for (const source in tools) {\n    const toolId = `tool_node_${source}`\n\n    const toolNode: DaffyToolNode = {\n      id: toolId,\n      node: FLOW_TO_DAFFY_NODES.tool,\n      parallel_tool_calling: true,\n      position: {\n        x: 0,\n        y: 0,\n      },\n      settings: {},\n      tools: [],\n    }\n    toolNode.tools.push(...tools[source])\n    let target: string | undefined\n    for (const node of daffyNodes) {\n      if (node.id === source && node.node === FLOW_TO_DAFFY_NODES.agent) {\n        const [index, edgeTarget] = findConditionalEdgeTarget(source, daffyEdges)\n\n        if (index) {\n          target = edgeTarget\n          daffyEdges.splice(index, 1)\n        }\n\n        if (!index)\n          target = DAFFY_END\n\n        node.tools.push(...tools[source])\n        break\n      }\n    }\n\n    if (target && end_nodes.includes(target))\n      target = DAFFY_END\n\n\n\n    console.log(target)\n    daffyNodes.push(toolNode)\n    daffyEdges.push({\n      id: `start_${toolId}_${source}`,\n      source,\n      target,\n      source_handle: 'tools',\n      condition: {\n        [toolId]: 'tools_condition',\n      },\n    }, {\n      id: `end_${toolId}_${source}`,\n      source: toolId,\n      target: source,\n      target_handle: 'tools',\n    })\n  }\n\n  return {\n    nodes: daffyNodes,\n    edges: daffyEdges,\n  }\n}\n"],"mappings":";AAAA,MAAa,sBAAsB;CACjC,WAAW;CACX,SAAS;CACT,UAAU;CACV,oBAAoB;CACpB,4BAA4B;CAC5B,wBAAwB;CACxB,wBAAwB;CACzB;AAED,MAAa,cAAc;AAC3B,MAAa,YAAY;AAEzB,MAAa,sBAAsB;CACjC,OAAO;CACP,KAAK;CACL,MAAM;CACN,iBAAiB;CACjB,wBAAwB;CACxB,qBAAqB;CACrB,qBAAqB;CACtB;AAED,MAAa,sBAAsB;CACjC,KAAK;CACL,OAAO;CACP,UAAU;CACV,UAAU;CACV,uBAAuB;CACvB,MAAM;CACP;AAED,MAAa,sBAAsB;CACjC,SAAS;CACT,oBAAoB;CACpB,eAAe;CACf,kBAAkB;CAClB,yBAAyB;CACzB,aAAa;CACd;;;;ACnCD,SAAgB,cAAc,OAAqD;CACjF,MAAMA,QAAgB,CACpB;EAAE,IAAI;EAAS,MAAM;EAAS,UAAU;GAAE,GAAG;GAAM,GAAG;GAAG;EAAE,WAAW;EAAO,EAC7E;EAAE,IAAI;EAAO,MAAM;EAAO,UAAU;GAAE,GAAG;GAAK,GAAG;GAAG;EAAE,WAAW;EAAO,CACzE;CACD,MAAMC,QAAgB,EAAE;AAExB,MAAK,MAAM,aAAa,MAAM,MAAM,QAAO,MAAK,EAAE,SAAS,WAAW,CACpE,OAAM,KAAK;EACT,IAAI,UAAU;EACd,MAAM,oBAAoB,UAAU;EACpC,UAAU,UAAU;EACpB,MAAM;GACJ,GAAG,UAAU;GACb,GAAI,2BAA2B,YAAY,EAAE,uBAAuB,UAAU,uBAAuB,GAAG,EAAE;GAC3G;EACF,CAAC;AAGJ,OAAM,MAAM,QAAO,MAAK,EAAE,SAAS,YAAY,CAAC,SAAS,SAAS;AAChE,OAAK,MAAM,SAAS,SAAS;GAC3B,MAAM,WAAW,oBAAoB,KAAK;AAC1C,SAAM,KAAK;IACT,IAAI,KAAK,MAAM,aAAa,SAAS,GAAG,KAAK;IAC7C,MAAM,oBAAoB;IAC1B,UAAU,KAAK,YAAY;KAAE,GAAG;KAAG,GAAG;KAAG;IACzC,MAAM;KACJ,OAAO;KACP,QAAQ,KAAK;KACd;IACF,CAAC;IACF;AACF,QAAM,KAAK,GAAG,KAAK,MAAM,KAAK,MAAM,UAAU;GAC5C,MAAM,WAAW,oBAAoB,KAAK;AAC1C,UAAO;IACL,IAAI,aAAa,SAAS,GAAG;IAC7B,QAAQ,KAAK;IACb,QAAQ,KAAK,MAAM,aAAa,SAAS,GAAG,KAAK;IACjD,cAAc;IACf;IACD,CAAC;GACH;AAEF,OAAM,KAAK,GAAG,MAAM,MAAM,QAAO,MAAK,CAAC,EAAE,OAAO,WAAW,YAAY,IAAI,CAAC,OAAO,KAAK,EAAE,aAAa,EAAE,CAAC,CAAC,SAAS,YAAY,CAAC,CAAC,KAAK,GAAG,WAAW;EACnJ,IAAI,EAAE,MAAM,GAAG,EAAE,OAAO,GAAG,EAAE,OAAO,GAAG;EACvC,QAAQ,EAAE;EACV,QAAQ,EAAE,UAAU,OAAO,KAAK,EAAE,aAAa,EAAE,CAAC,CAAC,MAAM;EACzD,cAAc,EAAE;EAChB,cAAc,EAAE;EACjB,EAAiB,CAAC;AAEnB,QAAO;EACL;EACA;EACD;;;;;ACtDH,SAAgB,eAAe,QAAgB,OAAkD;AAC/F,MAAK,MAAM,CAAC,OAAO,SAAS,MAAM,SAAS,EAAE;AAC3C,MAAI,WAAW,KAAK,OAAQ,QAAO,CAAC,OAAO,KAAK,OAAO;AACvD,MAAI,WAAW,KAAK,OAAQ,QAAO,CAAC,OAAO,KAAK,OAAO;;AAEzD,QAAO,EAAE;;AAGX,SAAgB,0BAA0B,QAAgB,OAAuD;AAC/G,MAAK,MAAM,CAAC,OAAO,SAAS,MAAM,SAAS,CACzC,KAAI,WAAW,KAAK,OAAQ,QAAO,CAAC,OAAO,KAAK,OAAO;AAEzD,QAAO,EAAE;;AAGX,SAAgB,eAAe,QAAgB,OAA6B;AAC1E,MAAK,MAAM,QAAQ,MACjB,KAAI,KAAK,WAAW,UAAU,KAAK,WAAW,UAC5C,QAAO;AAGX,QAAO;;;;;ACpBT,SAAgB,YAAY,OAAe,OAA2B;CACpE,MAAMC,aAA0B,EAAE;CAClC,MAAMC,aAA0B,EAAE;CAClC,MAAMC,QAAqC,EAAE;CAE7C,MAAMC,YAAsB,EAAE;AAC9B,MAAK,MAAM,QAAQ,OAAO;AACxB,MAAI,KAAK,SAAS,WAAW,KAAK,SAAS,OAAO;AAChD,aAAU,KAAK,KAAK,GAAG;AACvB;;EAGF,MAAM,WAAW,oBAAoB,KAAK;AAE1C,MAAI,aAAa,YAAY;GAC3B,MAAM,CAAC,OAAO,cAAc,eAAe,KAAK,IAAI,MAAM;GAC1D,MAAM,WAAW,KAAK,KAAK;AAC3B,OAAI,CAAC,cAAc,UAAU,UAAa,EAAE,YAAY,qBAAsB;GAE9E,MAAM,gBAAgB,oBAAoB;AAE1C,OAAI,CAAC,OAAO,KAAK,MAAM,CAAC,SAAS,WAAW,CAC1C,OAAM,cAAc,EAAE;AAExB,SAAM,YAAY,KAAK;IACrB,IAAI,KAAK;IACT,UAAU,KAAK;IACf,MAAM;IACN,UAAU,KAAK,KAAK;IACrB,CAAC;AAEF,SAAM,OAAO,OAAO,EAAE;AACtB;;AAGF,MAAI,aAAa,aAAa;GAC5B,MAAM,EAAE,wBAAwB,KAAM,GAAG,aAAa,KAAK,QAAQ,EAAE;AACrE,cAAW,KAAK;IACd,IAAI,KAAK;IACT,MAAM,oBAAoB;IAC1B,UAAU,KAAK;IACf;IACA;IACA,OAAO,EAAE;IACV,CAAC;AACF;;AAGF,aAAW,KAAK;GACd,IAAI,KAAK;GACT,MAAM;GACN,UAAU,KAAK;GACf,UAAU,KAAK;GAChB,CAAC;;AAGJ,MAAK,MAAM,QAAQ,OAAO;EACxB,IAAI,SAAS,KAAK;AAClB,MAAI,UAAU,SAAS,OAAO,CAC5B,UAAS;AAEX,MAAI,WAAW,aAAa,eAAe,KAAK,QAAQ,WAAW,CACjE;AAEF,aAAW,KAAK;GACd,IAAI,KAAK;GACT,QAAQ,KAAK;GACb;GACA,eAAe,KAAK,gBAAgB;GACpC,eAAe,KAAK,gBAAgB;GACrC,CAAqB;;AAGxB,MAAK,MAAM,UAAU,OAAO;EAC1B,MAAM,SAAS,aAAa;EAE5B,MAAMC,WAA0B;GAC9B,IAAI;GACJ,MAAM,oBAAoB;GAC1B,uBAAuB;GACvB,UAAU;IACR,GAAG;IACH,GAAG;IACJ;GACD,UAAU,EAAE;GACZ,OAAO,EAAE;GACV;AACD,WAAS,MAAM,KAAK,GAAG,MAAM,QAAQ;EACrC,IAAIC;AACJ,OAAK,MAAM,QAAQ,WACjB,KAAI,KAAK,OAAO,UAAU,KAAK,SAAS,oBAAoB,OAAO;GACjE,MAAM,CAAC,OAAO,cAAc,0BAA0B,QAAQ,WAAW;AAEzE,OAAI,OAAO;AACT,aAAS;AACT,eAAW,OAAO,OAAO,EAAE;;AAG7B,OAAI,CAAC,MACH,UAAS;AAEX,QAAK,MAAM,KAAK,GAAG,MAAM,QAAQ;AACjC;;AAIJ,MAAI,UAAU,UAAU,SAAS,OAAO,CACtC,UAAS;AAIX,UAAQ,IAAI,OAAO;AACnB,aAAW,KAAK,SAAS;AACzB,aAAW,KAAK;GACd,IAAI,SAAS,OAAO,GAAG;GACvB;GACA;GACA,eAAe;GACf,WAAW,GACR,SAAS,mBACX;GACF,EAAE;GACD,IAAI,OAAO,OAAO,GAAG;GACrB,QAAQ;GACR,QAAQ;GACR,eAAe;GAChB,CAAC;;AAGJ,QAAO;EACL,OAAO;EACP,OAAO;EACR"}